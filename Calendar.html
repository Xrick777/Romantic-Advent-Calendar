<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Previsioni Meteo</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

    <link rel="stylesheet" href="styles.css">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.2/dist/leaflet.css">
    <script src="https://unpkg.com/leaflet@1.9.2/dist/leaflet.js"></script>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
</head>

<body>

    <div id="header">
        <h2><i class="fa-solid fa-cloud-sun-rain"></i>  Previsioni Meteo</h2>

        <div>
          <input type="checkbox" class="checkbox" id="checkbox">
          <label for="checkbox" class="checkbox-label">
            <i class="fas fa-moon"></i>
            <i class="fas fa-sun"></i>
            <span class="ball"></span>
          </label>
        </div>
    </div>

    <p>Clicca sulla mappa per ottenere le previsioni meteo.</p>

    <div id="mappa"></div>

    <p id="informazioni"></p>

    <table>
        <tr>
            <th>Data</th>
            <th>Precipitazioni [mm]</th>
            <th>Temp. Min [°C]</th>
            <th>Temp. Max [°C]</th>
        </tr>
        <tr>
            <td id="g0_data"></td>
            <td id="g0_precipitazioni"></td>
            <td id="g0_temp_min"></td>
            <td id="g0_temp_max"></td>
        </tr>
        <tr>
            <td id="g1_data"></td>
            <td id="g1_precipitazioni"></td>
            <td id="g1_temp_min"></td>
            <td id="g1_temp_max"></td>
        </tr>
        <tr>
            <td id="g2_data"></td>
            <td id="g2_precipitazioni"></td>
            <td id="g2_temp_min"></td>
            <td id="g2_temp_max"></td>
        </tr>
    </table>

    <script>

        $("#checkbox").on("change", function(){
            $("body").toggleClass("dark-theme");
        });


        var map = L.map('mappa').setView([37.5, 15.09], 8);

        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '© OpenStreetMap'
        }).addTo(map);


        map.on('click', clickSuMappa);

        function clickSuMappa(e) {

            let urlmeteo =
            "https://api.open-meteo.com/v1/forecast?latitude=" +
            e.latlng.lat +
            "&longitude=" +
            e.latlng.lng +
            "&daily=temperature_2m_max,temperature_2m_min,rain_sum&timezone=Europe%2FRome";

            $.ajax({
                type: 'GET',
                url: urlmeteo,
                dataType: 'json',
                success: function (data) {

                    document.getElementById("informazioni").innerHTML =
                        "Località selezionata: lat " +
                        data.latitude.toFixed(3) +
                        ", lon " +
                        data.longitude.toFixed(3);

                    // Popolamento tabella
                    for (let i = 0; i < 3; i++) {
                        document.getElementById(`g${i}_data`).innerHTML = data.daily.time[i];
                        document.getElementById(`g${i}_precipitazioni`).innerHTML = data.daily.rain_sum[i] + " mm";
                        document.getElementById(`g${i}_temp_min`).innerHTML = data.daily.temperature_2m_min[i] + " °C";
                        document.getElementById(`g${i}_temp_max`).innerHTML = data.daily.temperature_2m_max[i] + " °C";
                    }
                }
            });
        }

    </script>

</body>
</html>
